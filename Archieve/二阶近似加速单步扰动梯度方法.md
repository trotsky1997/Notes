

## https://arxiv.org/pdf/1909.05840.pdf

这篇文章里，作者使用了一种基于矩阵自由幂迭代法的方法来计算hessian的特征值，而不需要显式地构造hessian矩阵。具体来说，对于第i层的梯度gi，对于一个与gi同维度的随机向量v，我们有：
$$
\frac{\partial g_i^T v}{\partial W_i} = \frac{\partial g_i^T}{\partial W_i} v = H_i v
$$
其中，$H_i$是第i层的hessian矩阵。这里，第二个等式成立是因为v与$W_i$无关。然后，我们可以用幂迭代法来计算$H_i$的最大特征值，算法见附录中的算法1。我们用$\lambda_i$表示$H_i$的最大特征值的分布，用10%的训练数据来计算。



有了每一层的Hessian的最大特征值的分布，可以用以下方法计算Hessian矩阵：

- 首先，需要知道Hessian矩阵是一个二阶导数矩阵，它由函数的所有二阶偏导数组成。Hessian矩阵的公式如下：
$$
Hf(x) = \begin{bmatrix}
\frac{\partial^2 f}{\partial x_1^2} & \frac{\partial^2 f}{\partial x_1 \partial x_2} & \cdots & \frac{\partial^2 f}{\partial x_1 \partial x_n} \
\frac{\partial^2 f}{\partial x_2 \partial x_1} & \frac{\partial^2 f}{\partial x_2^2} & \cdots & \frac{\partial^2 f}{\partial x_2 \partial x_n} \
\vdots & \vdots & \ddots & \vdots \
\frac{\partial^2 f}{\partial x_n \partial x_1} & \frac{\partial^2 f}{\partial x_n \partial x_2} & \cdots & \frac{\partial^2 f}{\partial x_n^2}
\end{bmatrix}
$$
其中，$x = (x_1, x_2, \dots, x_n)$是函数的变量，$f$是函数的值。
- 其次，需要知道Hessian矩阵的特征值和特征向量的概念。特征值和特征向量是满足以下方程的标量$\lambda$和非零向量$v$：
$$
Hf(x) v = \lambda v
$$
特征值和特征向量可以用线性代数的方法求解，例如幂迭代法或者特征值分解。
- 最后，如果已经知道了每一层的Hessian矩阵的最大特征值的分布，那么可以用以下步骤来计算Hessian矩阵：
    - 对于每一层，选择一个随机向量$v_0$，并用幂迭代法计算最大特征值$\lambda$和对应的特征向量$v$。
    - 用特征值分解的公式，将Hessian矩阵表示为：
$$
Hf(x) = V \Lambda V^{-1}
$$
其中，$V$是一个由特征向量组成的矩阵，$\Lambda$是一个由特征值组成的对角矩阵。
    - 由于只知道最大特征值，所以可以假设其他特征值都为零，从而简化Hessian矩阵的计算。即：

$$
Hf(x) \approx v \lambda v^T
$$
其中，$v$是最大特征值对应的特征向量，$\lambda$是最大特征值，$v^T$是特征向量的转置。
这就是一种可能的方法来计算Hessian矩阵，希望对您有所帮助。😊

## Ours

$$
\theta ∈ \mathbf{R}^{p}\\
\mathbf{D}_{k} = \hat{H}^{-1}_{k} \\
\hat{\theta}_{k+1}=\hat{\theta}_{k}-\mathbf{D}_{k}\hat{g}_{k}\cdot c_{k}  \\
c_k > 0,c_k∈ \mathbf{R}^{1}\\
\Delta_k =[\Delta_{k1},\Delta_{k2},...\Delta_{kp}],\\\Delta_{ki} \sim B(n,prob),\mathbb{E}[\Delta_{k}]=\mathbf{0}\\
\hat{g}_{k}=\frac{L(\theta_{k}+c_{k}\Delta_{k})+\epsilon_{k}} {c_{k}}\Delta_{k}^{-1}\\
y_{k}=\hat{g}_{k+1}-\hat{g}_{k} \\
s_{k}=-\mathbf{D}_{k}\hat{g}_{k}\cdot c_k \\
\mathbf{D}_{k+1}=\mathbf{D}_{k}+\frac{s_{k}s_{k}^{T}}{s_{k}^{T}y_{k}}-\frac{\mathbf{D}_{k}y_{k}y_{k}^{T}\mathbf{D}_{k}}{y_{k}^{T}\mathbf{D}_{k}y_{k}}
$$

